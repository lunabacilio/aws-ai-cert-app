<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz - AWS AI Practitioner</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
</head>
<body>
    <div class="container-fluid bg-light min-vh-100">
        <!-- Header with progress -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="{{ url_for('index') }}">
                    <i class="fas fa-cloud me-2"></i>
                    AWS AI Practitioner Quiz
                </a>
                
                <!-- Progress in header -->
                <div class="navbar-nav ms-auto">
                    <span class="navbar-text">
                        <i class="fas fa-chart-line me-1"></i>
                        Question {{ progress.current }} of {{ progress.total }}
                    </span>
                </div>
            </div>
        </nav>

        <div class="container py-4">
            <!-- Progress bar -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-body py-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <small class="text-muted">Quiz Progress</small>
                                <small class="text-muted">{{ progress.percentage }}% completed</small>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar bg-success progress-bar-striped progress-bar-animated" 
                                     role="progressbar" 
                                     style="width: {{ progress.percentage }}%"
                                     aria-valuenow="{{ progress.percentage }}" 
                                     aria-valuemin="0" 
                                     aria-valuemax="100">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main question -->
            <div class="row justify-content-center">
                <div class="col-lg-10 col-xl-8">
                    <div class="card shadow-lg border-0">
                        <div class="card-header bg-primary text-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-question-circle me-2"></i>
                                    Question #{{ question.question_number }}
                                </h5>
                                <span class="badge bg-light text-primary">
                                    {{ progress.current }}/{{ progress.total }}
                                </span>
                            </div>
                        </div>
                        
                        <div class="card-body p-4">
                            <!-- Question text -->
                            <div class="question-text mb-4">
                                <p class="lead text-dark">{{ question.question_text }}</p>
                            </div>

                            <!-- Answer form -->
                            <form action="{{ url_for('submit_immediate') }}" method="POST" id="answerForm">
                                <div class="options-container">
                                    {% if question.correct_answer is mapping %}
                                        <!-- Multiple mapping questions (HOTSPOT) -->
                                        <div class="alert alert-warning mb-3">
                                            <i class="fas fa-map-signs me-2"></i>
                                            <strong>Mapping question:</strong> Select the correct option for each element.
                                        </div>
                                        
                                        {% for sub_question_key, option_list in question.options.items() %}
                                        <div class="mapping-item mb-4 p-3 border rounded bg-light">
                                            <h6 class="fw-bold text-primary mb-3">
                                                {{ sub_question_key.replace('_', ' ').title() }}:
                                            </h6>
                                            
                                            <div class="row">
                                                {% for option in option_list %}
                                                <div class="col-md-6 mb-2">
                                                    <div class="form-check">
                                                        <input class="form-check-input mapping-input" 
                                                               type="radio" 
                                                               name="mapping_{{ sub_question_key }}" 
                                                               id="mapping_{{ sub_question_key }}_{{ loop.index }}" 
                                                               value="{{ option }}"
                                                               required>
                                                        <label class="form-check-label" for="mapping_{{ sub_question_key }}_{{ loop.index }}">
                                                            {{ option }}
                                                        </label>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        {% endfor %}
                                    
                                    {% else %}
                                        {% set is_multiple = question.correct_answer|length > 1 %}
                                        {% if is_multiple %}
                                            <!-- Multiple choice questions -->
                                            <div class="alert alert-info mb-3">
                                                <i class="fas fa-info-circle me-2"></i>
                                                <strong>Multiple choice:</strong> This question may have more than one correct answer. Select all that apply.
                                            </div>
                                            {% for option_key, option_text in question.options.items() %}
                                            <div class="form-check option-item mb-3">
                                                <input class="form-check-input answer-input" 
                                                       type="checkbox" 
                                                       name="answer" 
                                                       id="option_{{ option_key }}" 
                                                       value="{{ option_key }}">
                                                <label class="form-check-label option-label" for="option_{{ option_key }}">
                                                    <div class="option-card">
                                                        <div class="option-letter">{{ option_key }}</div>
                                                        <div class="option-content">{{ option_text }}</div>
                                                    </div>
                                                </label>
                                            </div>
                                            {% endfor %}
                                        {% else %}
                                            <!-- Single answer questions -->
                                            {% for option_key, option_text in question.options.items() %}
                                            <div class="form-check option-item mb-3">
                                                <input class="form-check-input answer-input" 
                                                       type="radio" 
                                                       name="answer" 
                                                       id="option_{{ option_key }}" 
                                                       value="{{ option_key }}"
                                                       required>
                                                <label class="form-check-label option-label" for="option_{{ option_key }}">
                                                    <div class="option-card">
                                                        <div class="option-letter">{{ option_key }}</div>
                                                        <div class="option-content">{{ option_text }}</div>
                                                    </div>
                                                </label>
                                            </div>
                                            {% endfor %}
                                        {% endif %}
                                    {% endif %}
                                </div>

                                <!-- Action buttons -->
                                <div class="d-flex justify-content-between mt-4">
                                    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                                        <i class="fas fa-home me-2"></i>
                                        Back to Home
                                    </a>
                                    
                                    <button type="submit" class="btn btn-primary btn-lg" id="submitBtn" disabled>
                                        <i class="fas fa-check me-2"></i>
                                        Answer
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Additional information -->
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card bg-light border-0">
                                <div class="card-body text-center py-3">
                                    <i class="fas fa-info-circle text-info mb-2"></i>
                                    <small class="text-muted d-block">Mode: Immediate Feedback</small>
                                    <small class="text-muted">You will see the answer after submitting</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-light border-0">
                                <div class="card-body text-center py-3">
                                    <i class="fas fa-clock text-warning mb-2"></i>
                                    <small class="text-muted d-block">Recommended time</small>
                                    <small class="text-muted">2-3 minutes per question</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const answerInputs = document.querySelectorAll('.answer-input, .mapping-input');
            const submitBtn = document.getElementById('submitBtn');
            const form = document.getElementById('answerForm');

            // Determine question type
            const hasCheckboxes = document.querySelector('input[type="checkbox"]:not(.mapping-input)');
            const hasRadios = document.querySelector('input[type="radio"]:not(.mapping-input)');
            const hasMappings = document.querySelector('.mapping-input');

            // Enable button when an answer is selected
            answerInputs.forEach(input => {
                input.addEventListener('change', function() {
                    let hasSelection = false;
                    
                    if (hasMappings) {
                        // For mapping questions, verify that all sub-questions have an answer
                        const mappingGroups = new Set();
                        document.querySelectorAll('.mapping-input').forEach(input => {
                            const groupName = input.name;
                            mappingGroups.add(groupName);
                        });
                        
                        let allGroupsAnswered = true;
                        mappingGroups.forEach(groupName => {
                            const groupInputs = document.querySelectorAll(`input[name="${groupName}"]`);
                            const hasAnswer = Array.from(groupInputs).some(input => input.checked);
                            if (!hasAnswer) {
                                allGroupsAnswered = false;
                            }
                        });
                        
                        hasSelection = allGroupsAnswered;
                    } else if (hasCheckboxes) {
                        // For checkboxes, verify if at least one is checked
                        hasSelection = Array.from(document.querySelectorAll('.answer-input')).some(input => input.checked);
                    } else if (hasRadios) {
                        // For radio buttons, verify if any is checked
                        hasSelection = Array.from(document.querySelectorAll('.answer-input')).some(input => input.checked);
                    }
                    
                    submitBtn.disabled = !hasSelection;
                    if (hasSelection) {
                        submitBtn.classList.add('btn-pulse');
                    } else {
                        submitBtn.classList.remove('btn-pulse');
                    }
                });
            });

            // Handle form submission
            form.addEventListener('submit', function(e) {
                // For multiple choice questions, verify that at least one option is selected
                if (hasCheckboxes) {
                    const selectedOptions = Array.from(answerInputs).filter(input => input.checked);
                    if (selectedOptions.length === 0) {
                        e.preventDefault();
                        alert('Please select at least one option.');
                        return;
                    }
                }
                
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
            });

            // Keyboard shortcuts to select options
            document.addEventListener('keydown', function(e) {
                const key = e.key.toLowerCase();
                if (['a', 'b', 'c', 'd', 'e'].includes(key)) {
                    const option = document.getElementById('option_' + key.toUpperCase());
                    if (option) {
                        if (hasCheckboxes) {
                            // For checkboxes, toggle selection
                            option.checked = !option.checked;
                        } else {
                            // For radio buttons, select
                            option.checked = true;
                        }
                        option.dispatchEvent(new Event('change'));
                    }
                }
            });

            // Entry animation
            const questionCard = document.querySelector('.card.shadow-lg');
            questionCard.style.opacity = '0';
            questionCard.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                questionCard.style.transition = 'all 0.6s ease';
                questionCard.style.opacity = '1';
                questionCard.style.transform = 'translateY(0)';
            }, 100);

            // Hover effect on options
            const optionItems = document.querySelectorAll('.option-item');
            optionItems.forEach(item => {
                item.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateX(5px)';
                });
                
                item.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateX(0)';
                });
            });
        });
    </script>
</body>
</html>
